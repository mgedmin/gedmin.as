## Script (Python) "editCSVupdate"
##bind container=container
##bind context=context
##bind namespace=
##bind script=script
##bind subpath=traverse_subpath
##parameters=fn
##title=
##
request = container.REQUEST
if 'SAVE' in request.form or 'ADDROW' in request.form:
    csvdata = container.parseCSV(fn)
    nrow = 0
    for row in csvdata:
        ncol = 0
        for col in row:
            txt = request.form.get('c%d.%d' % (nrow, ncol), '')
            txt = txt.replace(",", '')
            csvdata[nrow][ncol] = txt
            ncol +=1
        while row and not row[-1]:
            del row[-1]
        nrow +=1
    if 'ADDROW' in request.form:
        csvdata += [['(new)']]
    data = '\n'.join([','.join(row) for row in csvdata])
    container[fn].manage_edit('', 'text/x-comma-separated', filedata=data)
    return "Saved: "
