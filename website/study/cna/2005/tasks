## Script (Python) "tasks"
##bind container=container
##bind context=context
##bind namespace=
##bind script=script
##bind subpath=traverse_subpath
##parameters=gr=None, pogr=None
##title=
##
taken = {}
exacttaken = {}
if gr:
    for row in container.list(gr=gr, pogr=pogr):
        task = row['task']
        exacttaken[task] = exacttaken.get(task, 0) + 1
        if task: task = task.split()[0]
        taken[task] = taken.get(task, 0) + 1

data = container.taskdata.data
rows = data.strip().splitlines()[1:]
result = []
for row in rows:
    cells = row.split(None, 1)
    task = cells[0]
    title = cells[1]
    shorttitle = title
    if len(shorttitle) > 30:
        shorttitle = ' '.join(title.split()[:5]) + "..."
    en = exacttaken.get(task, 0)
    n = taken.get(task, 0)
    if en > 1: cls = 'conflict'
    elif n: cls = 'taken'
    else: cls = ''
    result.append({'task': task, 'title': title, 'shorttitle': shorttitle,
                   'class': cls})
return result
