<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      tal:define="groups python:['3', '4', '5', 'N']">
  <head>
    <title>Atsiskaitymas</title>
    <style type="text/css">
      div.row label.label { display: block; float: left; width: 6em; }
      div.row { clear: left; margin-bottom: 1ex; margin-left: 1em; }
      div.tasks { float: right; padding-left: 5em; width: 45%; }
      div.tasks table { font-size: small; }
    </style>
    <script type="text/javascript">
      var last_selection = '<tal:x replace="python: request.get('student', '').decode('UTF-8')"/>';
      var students = new Object();
      <tal:block repeat="gr groups">
      students['<tal:x replace="gr"/>'] = new Array(
        <tal:block repeat="student python:here.list(gr)"
                   replace="python: '\'%s\',' % student['name'].decode('UTF-8')" />
        ''
      );
      </tal:block>
      function fill_students() {
        var gr_select = document.getElementById('gr');
        var student_select = document.getElementById('student');
        var gr = gr_select.options[gr_select.selectedIndex].value;
        student_select.options.length = 0;
        for (var i = 0;
             i <tal:x replace="structure string:&lt;"/> students[gr].length-1;
             i++) {
          student_select.options[i] = new Option(students[gr][i]);
          if (students[gr][i] == last_selection) {
            student_select.selectedIndex = i;
          }
        }
      }
    </script>
  </head>
  <body onload="fill_students()">
    <h1>Atsiskaitymas</h1>

    <p tal:define="global data here/enter_result_update"
       tal:replace="structure data/statusmsg" />

    <form action="" method="post">
    <div class="row">
      <label class="label" for="gr" accesskey="g"><u>G</u>rupė</label>
      <select size="1" name="gr" id="gr" onchange="fill_students()">
        <option tal:repeat="gr groups"
                tal:attributes="selected python: gr == request.get('gr') and 'selected' or None;
                                value gr"
                tal:content="gr" />
      </select>
    </div>
    <div class="row">
      <label class="label" for="student" accesskey="s"><u>S</u>tudentas</label>
      <select size="1" name="student" id="student">
      </select>
    </div>
    <div class="row">
      <input type="submit" name="SELECT" value="Rinktis" accesskey="r" />
    </div>
<tal:if condition="data/havestudent">
    <div class="row">
      Sąlyga: <span tal:replace="data/task" />
    </div>
    <div class="row">
      Atsiskaitė:
      <span tal:replace="python: ', '.join(data['done']) or 'nieko'" />
    </div>
    <div class="row">
      Atsiskaitėja: <span tal:replace="data/which" />
    </div>
    <div class="row">
      <label class="label" for="date" accesskey="d"><u>D</u>ata</label>
      <input id="date" type="text" name="date" tal:attributes="value data/date" />
    </div>
    <div class="row" tal:condition="python: data['delay'].startswith('+')">
      Skuba: <span tal:replace="data/delay" />
    </div>
    <div class="row" tal:condition="not:python: data['delay'].startswith('+')">
      Vėluoja: <span tal:replace="data/delay" />
    </div>
    <div class="row">
      <label class="label" for="what" accesskey="p"><u>P</u>rograma</label>
      <select size="1" name="what" tal:define="choices python:['C++', 'Java', 'C++/Java']">
        <option tal:repeat="item choices"
                tal:attributes="selected python: item == data['what'] and 'selected' or None"
                tal:content="item" />
      </select>
    </div>
    <div class="row">
      <input type="checkbox" name="multiclient" id="multiclient" />
      <label for="multiclient">Multiklientiškumas (+0.1)</label>
    </div>
    <div class="row">
      <input type="checkbox" name="recverr" id="recverr" />
      <label for="recverr">Tradicinė recv klaida (-0.1)</label>
    </div>
    <div class="row">
      <label class="label" for="extra" accesskey="b">+/- <u>b</u>alai</label>
      <input id="extra" type="text" name="extra" tal:attributes="value data/extra" />
    </div>
    <div class="row">
      <label class="label" for="notes" accesskey="a">P<u>a</u>stabos</label>
      <input id="notes" type="text" name="notes" tal:attributes="value data/notes" />
    </div>
    <div class="row">
      <input type="submit" name="UPDATE" value="Keisti" accesskey="K" />
    </div>
</tal:if>
    </form>

    <p><a href="http://mg.b4net.lt/study/cna">Pratybų puslapis</a>.</p>
    <p><a href="https://mg.b4net.lt/study/cna/choose_task">Užduoties pasirinkimas</a>.</p>

  </body>
</html>
